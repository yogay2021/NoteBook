# 策略记录表

## 初步的模型实验

| 策略编号 |    模型     |   F1    | FPS  |       时间       | 策略                                                         |
| -------- | :---------: | :-----: | :--: | :--------------: | ------------------------------------------------------------ |
| 0        | PP-YOLOE+-m | 0.76067 | 142  | 2023-02-19 23:01 | baseline                                                     |
| 0        | PP-YOLOE+-m | 0.79927 | 133  | 2023-02-22 19:21 | baseline+三倍原始数据增强                                    |
| A1       | PP-YOLOE+-m | 0.9785  | 148  | 2023-02-23 20:24 | 使用汉江离的双线程predict，未做任何修改                      |
| A2       | PP-YOLOE+-m | 0.98406 | 166  | 2023-03-03 19:41 | 汉江离的双线程predict+五倍原始数据增强                       |
| A3       | PP-YOLOE+-m | 0.97958 | 160  | 2023-03-09 19:07 | 汉江离的双线程predict+五倍原始数据增强+多约10轮训练，loss在后期波动剧烈且没有下降趋势。 |
| A4       | PP-YOLOE+-m | 0.97788 | 154  | 2023-03-18 22:44 | 汉江离的双线程predict+原始数据进行下采样实现均衡化+25轮训练+七种在线数据增强方法 |
| A5       | PP-YOLOE+-m | 0.98135 | 154  | 2023-03-19 18:51 | 汉的双线程predict+原始数据上采样补齐cone标签数实现均衡+15轮训练（5h）+随机变尺寸扩大至500+ |
| A6       | PP-YOLOE+-m | 0.98125 | 154  | 2023-03-19 19:10 | 在A5的基础上，在predict中修改了各个类的推理阈值为0.475       |
| A7       | PP-YOLOE+-m | 0.98135 | 174  | 2023-03-19 19:16 | 在A5的基础上，修改了predict中预测框的坐标输出精度，我将float修改为int。 |
| A8       | PP-YOLOE+-m | 0.98267 | 173  | 2023-03-19 22:21 | 汉的双线程predict+原始数据上采样补齐cone标签数实现均衡+30轮训练（10h）+随机变尺寸扩大至500+ |
| B1       | PP-YOLOE+-m | 0.98664 | 167  | 2023-03-19 23:09 | A8模型作为预训练权重+修改了loss为Diou_loss+80轮训练（5h）    |
| B2       | PP-YOLOE+-m | 0.98629 | 152  | 2023-03-21 19:16 | 在B1的基础上修改了多进程数目为8                              |
| C1       | PP-YOLOE+-m | 0.98441 | 167  | 2023-03-21 18:57 | 汉的双线程predict+loss为Diou_loss+五倍数据增强+训练了80轮（32h） |
| C2       | PP-YOLOE+-m | 0.98835 | 153  | 2023-03-21 21:35 | C1模型作为预训练权重+原始数据集+80轮训练+Diou_loss           |
| C3       | PP-YOLOE+-m | 0.98921 | 167  | 2023-03-22 18:50 | C1模型作为预训练权重+原始数据集+100轮训练+DIOULOSS           |
| C4       | PP-YOLOE+-m | 0.98914 | 153  | 2023-03-24 13:40 | C1作为预训练权重+两倍随机离线数据增强+Diou_loss+更加广泛的多尺度输入[576, 608, 640, 672, 704, 736, 768, 800,832,864,896,928,960,992,1024,1056,1088,1120,1152,1184]+80轮训练（lr = 0.005） |



## 关于predict.score阈值的测试

| 模型 |                    阈值                    |   F1    |    FPS    |
| :--: | :----------------------------------------: | :-----: | :-------: |
|  C4  |  [0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5]  | 0.98914 | 142.85714 |
|  C4  | [0.525, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5] | 0.98879 | 148.14815 |
|  C4  | [0.55, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5]  | 0.98879 | 148.14815 |
|  C4  | [0.48, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5]  | 0.98879 | 166.66667 |
|  C4  | [0.505, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5] | 0.98879 | 166.66667 |
|  C4  | [0.5, 0.52, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5]  | 0.98879 | 166.66667 |



## 第二阶段模型实验

| 策略编号 | 模型        | F1      | FPS  | 时间             | 策略                                                        |
| -------- | ----------- | ------- | ---- | ---------------- | ----------------------------------------------------------- |
| D        | PP-YOLOE+-m | 0.98741 | 166  | 2023-04-04 21:26 | 双线程predict+Diouloss+80e                                  |
| D1       | PP-YOLOE+-m | 0.98862 | 153  | 2023-04-05 14:57 | D+（训练中设置输入test，val[928,928]。模型导出阶段都为640） |
| D2       | PP-YOLOE+-m | 0.98956 | 125  | 2023-04-05 14:17 | D+（训练中设置输入test，val[800,800]。模型导出阶段都为640） |
| D5       | PP-YOLOE+-m | 0.98759 | 125  | 2023-04-05 22:12 | D+（训练尺寸直接设置的928，对于大尺寸检测有负面效果）       |
| D6       | PP-YOLOE+-m | 0.98827 | 153  | 2023-04-05 22:42 | D5+测试尺寸800                                              |
| D7       | PP-YOLOE+-m | 0.98516 | 142  | 2023-04-06 13:52 | D2+测试尺寸768                                              |
| D12      | PP-YOLOE+-m | 0.99042 | 153  | 2023-04-07 14:52 | D2+模型导出阶段将测试输入尺寸设置为576+nms阈值0.6           |
| D13      | PP-YOLOE+-m | 0.99042 | 166  | 2023-04-07 15:45 | D12+替换best_model 为model_final                            |

## 第三阶段模型实验

| 策略编号 | 模型        | F1      | FPS  | 时间             | 策略                                           |
| -------- | ----------- | ------- | ---- | ---------------- | ---------------------------------------------- |
| E        | PP-YOLOE+-m | 0.98954 | 160  | 2023-04-07 22:24 | D+所有数据作为训练集不设置测试集+总共训练180轮 |
| E1       | PP-YOLOE+-m | 0.99078 | 166  | 2023-04-07 22:31 | E+修改测试尺寸为576+阈值为0.6                  |



## 第三阶段模型测试

| 策略编号 | 模型        | F1      | FPS  | 时间             | 策略                                                         |
| -------- | ----------- | ------- | ---- | ---------------- | ------------------------------------------------------------ |
| F        | PP-YOLOE+-m | 0.99039 | 148  | 2023-04-28 20:09 | 官方数据集+自己标注拓展1w数据集+copypaste+4V+75epoch+640size推理 |
| F1       | PP-YOLOE+-m | 0.98914 | 166  | 2023-04-28 20:19 | F1+576size推理                                               |
| F2       | PP-YOLOE+-m | 0.99051 | 160  | 2023-04-28 20:25 | F+608size推理                                                |
| F3       | PP-YOLOE+-m | 0.99033 | 166  | 2023-04-28 20:38 | F+nms0.55                                                    |
| F4       | PP-YOLOE+-m | 0.98987 | 142  | 2023-04-28 20:48 | F+672size推理                                                |
| F5       | PP-YOLOE+-m | 0.99051 | 173  | 2023-04-28 20:54 | F+608size推理+nms0.65                                        |



## 关于NMS阈值的测试（默认值为0.7）

| 策略编号 | 模型        | F1      | FPS  | 时间             | 策略                              |
| -------- | ----------- | ------- | ---- | ---------------- | --------------------------------- |
| D3       | PP-YOLOE+-m | 0.98917 | 142  | 2023-04-05 15:11 | D2+替换MultiClassNMS为MatrixNMS   |
| D4       | PP-YOLOE+-m | 0.98939 | 153  | 2023-04-05 15:31 | D2+MultiClassNMS的阈值设置为0.73  |
| D8       | PP-YOLOE+-m | 0.98956 | 166  | 2023-04-06 14:05 | D2+MultiClassNMS的阈值设置为0.65  |
| D9       | PP-YOLOE+-m | 0.98991 | 148  | 2023-04-06 14:12 | D2+MultiClassNMS的阈值设置为0.60  |
| D10      | PP-YOLOE+-m | 0.98973 | 166  | 2023-04-06 14:19 | D2+MultiClassNMS的阈值设置为0.55  |
| D11      | PP-YOLOE+-m | 0.98991 | 173  | 2023-04-06 14:25 | D2+MultiClassNMS的阈值设置为0.575 |







# 确定有效的改进方案

1. loss使用Diou_loss
2. 预测结果坐标数据改float为int

![image-20230321192225224](https://yoga-typora-photo.oss-cn-beijing.aliyuncs.com/typora_img/image-20230321192225224.png)

3.多尺度，大尺度的输入

> [576, 608, 640, 672, 704, 736, 768, 800,832,864,896,928,960,992,1024,1056,1088,1120,1152,1184]

![image-20230324144638011](https://yoga-typora-photo.oss-cn-beijing.aliyuncs.com/typora_img/image-20230324144638011.png)



4.测试阶段大尺度输入：

经过多组测试，对于此项目576是一个很好的数字

5.nms阈值修改：

经过多组测试，0.575到0.6都能够达到较好的效果，甚至是最好。

